<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="pt">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Processar Ficheiros • inspector</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Montserrat-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Lato-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Processar Ficheiros">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">inspector</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-artigos" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Artigos</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-artigos">
<li><a class="dropdown-item" href="../articles/configuracao-inicial.html">Configuração Inicial do Projecto</a></li>
    <li><a class="dropdown-item" href="../articles/processar-ficheiros.html">Processar Ficheiros de Supervisão</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Processar Ficheiros</h1>
            
      

      <div class="d-none name"><code>processar-ficheiros.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="carregar-os-pacotes">Carregar os pacotes<a class="anchor" aria-label="anchor" href="#carregar-os-pacotes"></a>
</h2>
<p>Se ainda não o fez, abra uma nova sessão de trabalho no RStudio. Como
sempre, começaremos o nosso trabalho criando um novo script R (File
-&gt; New File -&gt; R script). Também vamos carregar os principais
pacotes R necessários para o trabalho.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/" class="external-link">glue</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usaid-mozambique.github.io/inspector/">inspector</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="guardar-ficheiros-de-supervisão">Guardar ficheiros de supervisão<a class="anchor" aria-label="anchor" href="#guardar-ficheiros-de-supervis%C3%A3o"></a>
</h2>
<p>Antes de escrever qualquer código, certifique-se de que todos os
ficheiros de dados brutos de supervisão csv estão guardados na pasta
“Data” do repositório do seu projeto. Isto facilitará o acesso aos
mesmos e manterá os vários documentos do projeto organizados.</p>
</div>
<div class="section level2">
<h2 id="criar-valores-e-listas-para-uso-posterior">Criar valores e listas para uso posterior<a class="anchor" aria-label="anchor" href="#criar-valores-e-listas-para-uso-posterior"></a>
</h2>
<p>Vamos agora criar um valor que se refere à data atual que será
utilizada quando começarmos a guardar os nossos ficheiros finais
processados. Também vamos criar um valor que aponta para a pasta na qual
os nossos dados em bruto estão armazenados. Finalmente, vamos criar uma
lista dos caminhos de todo o conjunto de ficheiros csv armazenados na
pasta “Data” do nosso repositório.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># criar carimbo de data</span></span>
<span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu">now</span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y%m%d"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># criar caminho aos dados brutos</span></span>
<span><span class="va">path_repo_input</span> <span class="op">&lt;-</span> <span class="st">"Data/"</span></span>
<span></span>
<span><span class="co"># criar vector dos caminhos dos dados brutos</span></span>
<span><span class="va">path_inputs</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">path_repo_input</span>, </span>
<span>               pattern <span class="op">=</span> <span class="st">".csv"</span>, </span>
<span>               full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="processar-ficheiros-brutos">Processar ficheiros brutos<a class="anchor" aria-label="anchor" href="#processar-ficheiros-brutos"></a>
</h2>
<p>Por fim, vamos chamar as funções <code>inspetor</code> para começar a
processar os nossos dados de supervisão. O Inspetor oferece-nos duas
funções que podemos utilizar em conjunto para 1) identificar erros de
processamento; e 2) realizar o processamento de forma iterativa em
vários ficheiros de entrada (particularmente útil uma vez que existem 49
formulários csv gerados para as actividades de supervisão).</p>
<p>O primeiro trecho de código abaixo que usa <code>map</code> e
<code>process_sqi_files</code> criará nosso relatório de erros, enquanto
o segundo trecho de código, quando fornecido um argumento com o valor do
nosso caminho apontando para os dados de entrada, retornará uma tabela
compilada de dados pronta para análise.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_safe</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">path_inputs</span>, </span>
<span>                      <span class="op">~</span> <span class="fu"><a href="../reference/process_sqi_file.html">process_sqi_file</a></span><span class="op">(</span><span class="va">.x</span>, safe <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_sqi_batch.html">process_sqi_batch</a></span><span class="op">(</span><span class="va">path_inputs</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="gravar-ficheiro-final-no-disco-local">Gravar ficheiro final no disco local<a class="anchor" aria-label="anchor" href="#gravar-ficheiro-final-no-disco-local"></a>
</h2>
<p>Como último passo, guardaremos os nossos dados processados na pasta
“Dataout” do nosso projeto, onde poderemos aceder aos mesmos para
análise em R ou noutras ferramentas de análise como o PowerBI ou o
Tableau. Abaixo, usamos um formato de arquivo compactado comum chamado
‘parquet’, que normalmente salva arquivos que têm apenas 3% do tamanho
de um formato csv ou txt. Note-se também que o nome do ficheiro parquet
gravado no disco rígido local inclui a data em que o código acima foi
executado! Isto significa que terá um conjunto organizado de ficheiros
facilmente reconhecíveis que lhe permitem ver como os dados mudam ao
longo do tempo!</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">write_parquet</span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">'Dataout/sqi_{date}.parquet'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Parabéns! Você, processou e exportou com sucesso um ficheiro de dados
de supervisão fácil de utilizar e organizado para utilização em
análises!</p>
<hr>
<p><em>Disclaimer: The findings, interpretation, and conclusions
expressed herein are those of the authors and do not necessarily reflect
the views of United States Agency for International Development. All
errors remain our own.</em></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joe Lara.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
